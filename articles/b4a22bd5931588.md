---
title: "ã€ŒA sibling ({}) of this resource already has a variable path partã€ã®å¯¾å¿œ"
emoji: "ğŸƒ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ['aws', 'awscdk', 'apigateway']
published: true
---

## å‰æ

cdkã§ãƒ‡ãƒ—ãƒ­ã‚¤ã—ãŸAPI Gatewayã®ãƒªã‚½ãƒ¼ã‚¹ãƒ‘ã‚¹ã®ãƒ‘ã‚¹å¤‰æ•°åã‚’å¤‰æ›´ã—ã‚ˆã†ã¨ã—ãŸéš›ã«ä¸‹è¨˜ã®ã‚¨ãƒ©ãƒ¼ãŒç”Ÿã˜ã¾ã—ãŸã€‚

```:ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
21:12:57 | CREATE_FAILED        | AWS::ApiGateway::Resource   | CreateApi/Default/{piyo}
Resource handler returned message: "A sibling ({hoge}) of this resource already has a variable path part -- only one is allowed (Service: ApiGa
teway, Status Code: 400, Request ID: 20d70bb5-6017-4daa-bd5b-c68c17f11c9d)" (RequestToken: 443e9cff-e29b-c640-7b03-d9657f86eac4, HandlerErrorCo
de: InvalidRequest)
```


```diff ts: ã‚¹ã‚¿ãƒƒã‚¯ã®å¤‰æ›´ç®‡æ‰€
import * as CDK from 'aws-cdk-lib';
import * as APIGATEWAY from 'aws-cdk-lib/aws-apigateway';
import { Construct } from 'constructs';

export class SetupApiStack extends CDK.Stack {
  constructor(scope: Construct, id: string, props: CDK.StackProps) {
    super(scope, id, props);

    // create mock integration
    const mockIntegration = new APIGATEWAY.MockIntegration({
      requestTemplates: {
        'application/json': '{ "statusCode": 200 }',
      },
      integrationResponses: [
        {
          statusCode: '200',
          responseTemplates: {
            'application/json': '{ "message": "ok" }',
          },
        },
      ],
    });

    // create api gateway
    const api = new APIGATEWAY.RestApi(this, 'SampleApi');

    api.root
-     .addResource('{old_path_var}')
+     .addResource('{new_path_var}')
      .addMethod('GET', mockIntegration, {
        methodResponses: [
          {
            statusCode: '200',
          },
        ],
      });
  }
}
```

â€»ã‚³ãƒ¼ãƒ‰ã®è¦‹ã‚„ã™ã•ã®ãŸã‚ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰éƒ¨åˆ†ã¯ãƒ¢ãƒƒã‚¯çµ±åˆã§è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚

## åŸå› 

CloudFormationã§ã¯ã¾ãšæ–°ã—ã„ãƒªã‚½ãƒ¼ã‚¹ãƒ‘ã‚¹ã‚’è¿½åŠ ã—ã‚ˆã†ã¨ã—ã€æ¬¡ã«å¤ã„ãƒªã‚½ãƒ¼ã‚¹ãƒ‘ã‚¹ã‚’å‰Šé™¤ã—ã‚ˆã†ã¨ã™ã‚‹ã‚ˆã†ã§ã™ã€‚ãã®ãŸã‚ã€ä¸¡æ–¹ã®ãƒªã‚½ãƒ¼ã‚¹ãƒ‘ã‚¹(`/{old_path_var}`ã¨`/{new_path_var}`)ãŒå­˜åœ¨ã™ã‚‹ä¸­é–“çŠ¶æ…‹ãŒç”Ÿã˜ã¾ã™ã€‚ã—ã‹ã—ã€ä¸¡ãƒªã‚½ãƒ¼ã‚¹ãƒ‘ã‚¹ã¯å¤‰æ•°åãŒç•°ãªã‚‹ã ã‘ã§ã€å®Ÿä½“ã¯åŒã˜ã‚‚ã®ã§ã™ã‹ã‚‰ãƒªã‚½ãƒ¼ã‚¹ãƒ‘ã‚¹ã®é‡è¤‡ã«ã‚ˆã‚Šã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚


## è§£æ±ºç­–

ã‚¹ã‚¿ãƒƒã‚¯ã‹ã‚‰å¤‰æ›´ã—ãŸã„ãƒªã‚½ãƒ¼ã‚¹ãƒ‘ã‚¹ã‚’å‰Šé™¤ã—ã¦ã€å¤‰æ›´ã—ãŸã„ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å®Œå…¨ã«å‰Šé™¤ã—ã¾ã™ã€‚ã“ã®ã¨ãã€å°‘ãªãã¨ã‚‚ä¸€ã¤ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ã¦ãŠã‹ãªã„ã¨ã‚¨ãƒ©ãƒ¼ãŒèµ·ãã‚‹ã®ã§ã€é©å½“ã«ãƒ‘ã‚¹ãƒªã‚½ãƒ¼ã‚¹ã«ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®šç¾©ã—ã¦ãŠãã¾ã™ã€‚

```diff ts
api.root
- .addResource('{old_path_var}')
+ .addResource('tmp_path')
  .addMethod('GET', mockIntegration, {
    methodResponses: [
      {
        statusCode: '200',
      },
    ],
  });
```

ãã‚‚ãã‚‚ä¸€åº¦APIãƒªã‚½ãƒ¼ã‚¹ã”ã¨å‰Šé™¤ã—ã¦ä½œã‚Šç›´ã—ã¦ã‚‚ã‚ˆã‹ã£ãŸã®ã§ã™ãŒã€ä»Šå›ã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã„ãªã‹ã£ãŸã“ã¨ã‚‚ã‚ã‚Šã€APIã”ã¨å‰Šé™¤ã—ã¦ã—ã¾ã†ã¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ›ã‚¹ãƒˆéƒ¨ãŒå¤‰ã‚ã£ã¦ã—ã¾ã†ãŸã‚ã€APIãƒªã‚½ãƒ¼ã‚¹è‡ªä½“ã¯å‰Šé™¤ã—ãªã„ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚

ã‚ã¨ã¯æ–°ãŸãªãƒ‘ã‚¹å¤‰æ•°åã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ãƒ‡ãƒ—ãƒ­ã‚¤ã—ã¦å®Œäº†ã§ã™ã€‚

```diff ts
api.root
- .addResource('tmp_path')
+ .addResource('{new_path_var}')
  .addMethod('GET', mockIntegration, {
    methodResponses: [
      {
        statusCode: '200',
      },
    ],
  });
```

## å‚è€ƒ
- [AWS API Gateway: Error when renaming path variable #3785](https://github.com/serverless/serverless/issues/3785)
